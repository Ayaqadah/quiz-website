<!DOCTYPE html>
<html>
<head>
  <title>Quiz ðŸ’—</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #ebdce2;
      padding: 40px;
      max-width: 700px;
      margin: auto;
      color: #444;
    }

    #quizBox {
      background: white;
      padding: 30px;
      border-radius: 25px;
      box-shadow: 0px 5px 20px rgba(255, 150, 180, 0.4);
    }

    h2 { color: #ff6fa8; }

    .answer {
      background: #ffeaf4;
      padding: 12px 15px;
      border-radius: 12px;
      margin: 10px 0;
      cursor: pointer;
      transition: 0.2s;
    }

    .answer:hover { background: #ffd3e7; }
    .correct { background: #c4f7c4 !important; border: 2px solid #4CAF50; }
    .wrong { background: #ffb7c5 !important; border: 2px solid #ff4b5c; }

    .disabled { pointer-events: none; opacity: 0.6; }

    button {
      padding: 12px 25px;
      margin-top: 20px;
      background: #ff6fa8;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 18px;
      cursor: pointer;
      transition: 0.3s;
      display: none;
    }

    button:hover { background: #ff4c92; }
  </style>
</head>
<body>

<div id="quizBox">

  <!-- Progress bar -->
  <div id="progressContainer" style="
    width:100%; background:#ffeaf4; border-radius:20px;
    height:18px; margin-bottom:20px; overflow:hidden;">
    <div id="progressBar" style="
      height:100%; width:0%; background:#ff6fa8;
      border-radius:20px; transition:0.4s;"></div>
  </div>

  <!-- Timer (hidden unless exam mode) -->
  <h2 id="timer" style="text-align:right; color:#ff4c92; display:none;">
    Time Left: 05:00
  </h2>

  <h2 id="courseTitle"></h2>
  <h3 id="moduleTitle"></h3>

  <h2 id="questionNumber"></h2>
  <p id="questionText"></p>
  <div id="answers"></div>

  <div style="display:flex; justify-content:space-between; margin-top:20px;">
    <button id="backBtn" onclick="prevQuestion()" style="display:none;">â¬… Back</button>
    <button id="nextBtn" onclick="nextQuestion()">Next âžœ</button>
  </div>
</div>

<script>
let course = localStorage.getItem("selectedCourse");
let moduleNum = localStorage.getItem("selectedModule");
let examMode = localStorage.getItem("examMode");

document.getElementById("courseTitle").innerText = course;

/* -----------------------------
   QUESTION BANK
---------------------------- */
const allQuestions = {
  "Machine Learning": {
   1: [
  { 
    question: "Q1: What does PCA stand for in the context of dimensionality reduction?", 
    options: [
      "A. Principal Component Analysis",
      "B. Partial Component Analysis",
      "C. Principal Cluster Analysis",
      "D. Partial Cluster Analysist"
    ],
    answer: 0
  },

  { 
    question: "Q2: What do supervised Machine Learning techniques automatically learn from?", 
    options: [
      "A. The structure of the algorithm",
      "B. A set of descriptive features and a target feature",
      "C. The program code itself",
      "D. The performance measure directly"
    ],
    answer: 1
  }
],
    2: [
      { question: "ML Module 2 Q1?", options: ["X", "Y", "Z"], answer: 1 }
    ]
  },

  "Data Mining": {
    1: [{ question: "DM Module 1 Q1?", options: ["A", "B", "C"], answer: 1 }]
  },

  "Decision Support Systems": {
    1: [{ question: "DSS Module 1 Q1?", options: ["A", "B", "C"], answer: 0 }]
  },

  "Data Security and Privacy": {
    1: [{ question: "DSP Module 1 Q1?", options: ["A", "B", "C"], answer: 2 }]
  },

  "Computer Vision": {
    1: [{ question: "CV Module 1 Q1?", options: ["A", "B", "C"], answer: 1 }]
  }
};

/* ----------------------------
   LOAD QUESTIONS BASED ON MODE
---------------------------- */
let questions = [];

if (examMode === "true") {
  document.getElementById("moduleTitle").innerText = "Final Exam";
  document.getElementById("timer").style.display = "block";

  for (let mod in allQuestions[course]) {
    questions = questions.concat(allQuestions[course][mod]);
  }

} else {
  document.getElementById("moduleTitle").innerText = "Module " + moduleNum;
  questions = allQuestions[course][moduleNum] || [];
}

questions = questions.sort(() => Math.random() - 0.5);

let index = 0;
let score = 0;
let answered = false;
let answersHistory = [];

/* ----------------------------
   TIMER FOR EXAM MODE ONLY
---------------------------- */
let totalTime = 300;
let timerInterval;

function startTimer() {
  timerInterval = setInterval(() => {
    totalTime--;
    let m = Math.floor(totalTime / 60);
    let s = totalTime % 60;
    if (s < 10) s = "0" + s;
    document.getElementById("timer").innerText = `Time Left: ${m}:${s}`;
    if (totalTime <= 0) finishQuizDueToTime();
  }, 1000);
}

/* ----------------------------
   DISPLAY QUESTION
---------------------------- */
function loadQuestion() {
  answered = false;

  // Start timer only once & only in exam mode
  if (index === 0 && examMode === "true") startTimer();

  // Progress bar update
  let progress = (index / questions.length) * 100;
  document.getElementById("progressBar").style.width = progress + "%";

  const q = questions[index];

  document.getElementById("questionNumber").innerText =
    "Question " + (index + 1) + " / " + questions.length;

  document.getElementById("questionText").innerText = q.question;

  const answersDiv = document.getElementById("answers");
  answersDiv.innerHTML = "";

  q.options.forEach((opt, i) => {
    answersDiv.innerHTML += `
      <div class="answer" onclick="selectAnswer(${i}, this)">
        ${opt}
      </div>`;
  });

  document.getElementById("nextBtn").style.display = "none";
}

/* ----------------------------
   SELECT ANSWER
---------------------------- */
function selectAnswer(selectedIndex, element) {
  if (answered) return;
  answered = true;

  const correctIndex = questions[index].answer;
  const options = document.querySelectorAll(".answer");

  answersHistory[index] = selectedIndex;

  options[correctIndex].classList.add("correct");

  if (selectedIndex !== correctIndex) {
    element.classList.add("wrong");
  } else score++;

  options.forEach(opt => opt.classList.add("disabled"));

  document.getElementById("nextBtn").style.display = "block";
  document.getElementById("backBtn").style.display = index > 0 ? "block" : "none";
}

/* ----------------------------
   NEXT QUESTION
---------------------------- */
function nextQuestion() {
  index++;

  if (index === questions.length) {
    clearInterval(timerInterval);
    finishQuiz();
  } else {
    loadQuestion();
  }
}

function finishQuiz() {
  localStorage.setItem("score", score);
  localStorage.setItem("reviewQuestions", JSON.stringify(questions));
  localStorage.setItem("reviewAnswers", JSON.stringify(answersHistory));
  window.location.href = "result.html";
}

function finishQuizDueToTime() {
  clearInterval(timerInterval);
  localStorage.setItem("timeUp", "yes");
  finishQuiz();
}

/* ----------------------------
   BACK BUTTON
---------------------------- */
function prevQuestion() {
  if (index === 0) return;

  index--;
  loadQuestion();

  let prev = answersHistory[index];
  if (prev !== undefined && prev !== null) {
    const options = document.querySelectorAll(".answer");

    options.forEach(opt => opt.classList.add("disabled"));

    if (prev === questions[index].answer) {
      options[prev].classList.add("correct");
    } else {
      options[prev].classList.add("wrong");
      options[questions[index].answer].classList.add("correct");
    }

    answered = true;
    document.getElementById("nextBtn").style.display = "block";
  }

  document.getElementById("backBtn").style.display = index > 0 ? "block" : "none";
}

loadQuestion();
</script>

</body>
</html>
